<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Framework to Marshal Objects to be Used in Another R Process • marshal</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><!-- docsearch --><script src="docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="Framework to Marshal Objects to be Used in Another R Process">
<meta property="og:description" content='Some types of R objects can be used only in the R session they were created.  If used as-is in another R process, such objects often result in an immediate error or in obscure and hard-to-troubleshoot outcomes.  Because of this, they cannot be saved to file and re-used at a later time.  They can also not be exported to a worker in parallel processing.  These objects are sometimes referred to as non-exportable or non-serializable objects.  One solution to this problem is to use "marshalling" to encode the R object into an exportable representation that then can be used to re-create a copy of that object in another R process.  This package provides a framework for marshalling and unmarshalling R objects such that they can be transferred using functions such as serialize() and unserialize() of base R.'>
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-SB3EQSD9FR"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-SB3EQSD9FR');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">marshal</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.0-9029</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li>
  <a href="news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://www.futureverse.org/" class="external-link">
    <span class="fas fa-home"></span>
     
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Packages
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="https://doFuture.futureverse.org" class="external-link">doFuture</a>
    </li>
    <li>
      <a href="https://furrr.futureverse.org" class="external-link">furrr</a>
    </li>
    <li>
      <a href="https://future.futureverse.org" class="external-link">future</a>
    </li>
    <li>
      <a href="https://future.apply.futureverse.org" class="external-link">future.apply</a>
    </li>
    <li>
      <a href="https://future.batchtools.futureverse.org" class="external-link">future.batchtools</a>
    </li>
    <li>
      <a href="https://future.callr.futureverse.org" class="external-link">future.callr</a>
    </li>
    <li>
      <a href="https://future.tests.futureverse.org" class="external-link">future.tests</a>
    </li>
    <li>
      <a href="https://globals.futureverse.org" class="external-link">globals</a>
    </li>
    <li>
      <a href="https://listenv.futureverse.org" class="external-link">listenv</a>
    </li>
    <li>
      <a href="https://parallelly.futureverse.org" class="external-link">parallelly</a>
    </li>
    <li>
      <a href="https://progressr.futureverse.org" class="external-link">progressr</a>
    </li>
    <li>
      <a href="https://BiocParallel.FutureParam.futureverse.org" class="external-link">BiocParallel.FutureParam (experimental)</a>
    </li>
    <li>
      <a href="https://future.tools.futureverse.org" class="external-link">future.tools (experimental)</a>
    </li>
    <li>
      <a href="https://future.mirai.futureverse.org" class="external-link">future.mirai (experimental)</a>
    </li>
    <li>
      <a href="https://future.mapreduce.futureverse.org" class="external-link">future.mapreduce (experimental)</a>
    </li>
    <li>
      <a href="https://marshal.futureverse.org">marshal (experimental)</a>
    </li>
  </ul>
</li>
<li>
  <a href="https://cloud.r-project.org/package=marshal" class="external-link">
    <span class="fab fa-r-project"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/HenrikBengtsson/marshal/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">


<div class="section level1">
<div class="page-header"><h1 id="marshal-framework-to-marshal-objects-to-be-used-in-another-r-process">marshal: Framework to Marshal Objects to be Used in Another R Process<a class="anchor" aria-label="anchor" href="#marshal-framework-to-marshal-objects-to-be-used-in-another-r-process"></a>
</h1></div>
<p>Some types of R objects can be used only in the R session they were created. If used as-is in another R process, such objects often result in an immediate error or in obscure and hard-to-troubleshoot outcomes. Because of this, they cannot be saved to file and re-used at a later time. They can also not be exported to a worker in parallel processing. These objects are sometimes referred to as non-exportable or non-serializable objects. One solution to this problem is to use “marshalling” to encode the R object into an exportable representation that then can be used to re-create a copy of that object in another R process. This package provides a framework for marshalling and unmarshalling R objects such that they can be transferred using functions such as <code><a href="https://rdrr.io/r/base/serialize.html" class="external-link">serialize()</a></code> and <code><a href="https://rdrr.io/r/base/serialize.html" class="external-link">unserialize()</a></code> of base R.</p>
<p><em>WARNING: This package is currently just a skeleton. Please stay tuned.</em></p>
<div class="section level2">
<h2 id="outcome">Outcome<a class="anchor" aria-label="anchor" href="#outcome"></a>
</h2>
<p>When <code><a href="reference/marshal.html">marshal()</a></code> and <code><a href="reference/marshal.html">unmarshal()</a></code> methods have been implemented for some of the “non-exportable” object types, it will be possible to use also these objects in a later or another R session and in parallel R workers. Here are some example of functions that will be able to take advantage of marshalling:</p>
<ul>
<li>
<code>raw &lt;- serialize(x, connection = NULL)</code> and <code>y &lt;- unserialize(raw)</code> - serialize object <code>x</code> to a raw byte sequence, from which then the original object can be reconstructed</li>
<li>
<code>save(x, y, file = "xy.RData")</code> and <code>load("xy.RData")</code> - save and reload R objects to a binary file by their names</li>
<li>
<code>saveRDS(x, "x.rds")</code> and <code>y &lt;- readRDS("x.rds")</code> - save and reload an R object to a binary file</li>
<li>
<code><a href="https://rdrr.io/r/base/save.html" class="external-link">save.image()</a></code>: saves the global environment to an ‘.RData’ file. Next time R is launched, this the global environment is recreated. This function is called by for instance <code>quit(save = "yes")</code>
</li>
<li>
<code>parallel::clusterExport(cl, varlist = c("x", "y"))</code> - export variables <code>x</code> and <code>y</code> to a parallel workers</li>
<li>
<code>f &lt;- future::future(x * y)</code> - export variables <code>x</code> and <code>y</code> to a parallel workers and evaluate the expression</li>
</ul>
</div>
<div class="section level2">
<h2 id="roadmap">Roadmap<a class="anchor" aria-label="anchor" href="#roadmap"></a>
</h2>
<ol style="list-style-type: decimal">
<li>
<p>Phase “Getting Started”</p>
<ul class="task-list">
<li><p><label><input type="checkbox">Start on a rudimentary “marshalling” protection framework based on the internal <strong>future</strong> functions <code><a href="reference/find_references.html">assert_no_references()</a></code>, <code><a href="reference/find_references.html">find_references()</a></code> and <code>reference_filters()</code></label></p></li>
<li><p><label><input type="checkbox">Document common cases of packages with non-exportable objects as one or more vignettes. The <a href="https://cran.r-project.org/package=future/vignettes/future-4-non-exportable-objects.html" class="external-link">A Future for R: Non-Exportable Objects</a> vignette is a good start. For each package give at least one example that show the mistake, how to detect it with above protection functions, and when possible give workaround examples. Illustrate with both sequential use cases (e.g. <code><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS()</a></code> and <code><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS()</a></code>) and with parallelization (e.g. <code><a href="https://rdrr.io/r/parallel/clusterApply.html" class="external-link">parallel::clusterEvalQ()</a></code>, <code>foreach::foreach() %dopar% { ... }</code>, and <code><a href="https://future.futureverse.org/reference/future.html" class="external-link">future::future()</a></code></label></p></li>
<li><p><label><input type="checkbox">Invite R community to report on more cases to build up a knowledge base and make the <strong>marshal</strong> documentation a go-to reference for explaining the problem</label></p></li>
</ul>
</li>
<li>
<p>Phase “Detect &amp; Protection”</p>
<ul class="task-list">
<li>
<p><label><input type="checkbox">Detect and report on non-exportable objects via the condition system</label></p>
<ul class="task-list">
<li><p><label><input type="checkbox">objects with external pointers</label></p></li>
<li><p><label><input type="checkbox">connection objects</label></p></li>
<li><p><label><input type="checkbox">…</label></p></li>
</ul>
</li>
<li><p><label><input type="checkbox">Develop set of acceptance filters to handle false positives, e.g. <code><a href="https://Rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table::data.table</a></code> objects</label></p></li>
<li><p><label><input type="checkbox">Develop set of reject filters to handle true positives with specific, more informative error messages, e.g. connection objects</label></p></li>
</ul>
</li>
<li>
<p>Phase “Marshalling”</p>
<ul class="task-list">
<li>
<p><label><input type="checkbox">Add S3 generic <code><a href="reference/marshal.html">marshal()</a></code> to re-deconstruct non-exportable objects of certain classes so that they can be re-constructed using <code><a href="reference/marshal.html">unmarshal()</a></code> afterward, e.g.</label></p>
<ul class="task-list">
<li><p><label><input type="checkbox">‘XMLAbstractDocument’ of <strong>XML</strong>, cf. <code><a href="https://rdrr.io/pkg/XML/man/xmlSerializeHook.html" class="external-link">XML::xmlSerializeHook()</a></code> and <code><a href="https://rdrr.io/pkg/XML/man/xmlSerializeHook.html" class="external-link">XML::xmlDeserializeHook()</a></code></label></p></li>
<li><p><label><input type="checkbox">base R URL and read-only file connections</label></p></li>
<li><p><label><input type="checkbox">Identify packages whose non-exportable objects may be marshalled similarly, e.g. <strong>ShortRead</strong> and <strong>ncdf4</strong></label></p></li>
</ul>
</li>
</ul>
</li>
</ol>
<ul class="task-list">
<li><p><label><input type="checkbox">Implement efficient, recursive <code><a href="reference/marshal.html">marshal()</a></code> for sets such as lists and environments</label></p></li>
<li><p><label><input type="checkbox">After marshalling an object, or, say, a list of objects, investigate if we can leverage R’s serialization framework to automatically unmarshal objects via <code>base::unserialize(..., refhook = unmarshal)</code>. We might be able to do this by having <code><a href="reference/marshal.html">marshal()</a></code> appending a “trigger” reference to the marshalled object</label></p></li>
<li><p><label><input type="checkbox">Support for marshalling directly to a connection. This may avoid a large memory footprint</label></p></li>
</ul>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>R package marshal is only available via <a href="https://github.com/HenrikBengtsson/marshal" class="external-link">GitHub</a> and can be installed in R as:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"HenrikBengtsson/marshal"</span>, ref<span class="op">=</span><span class="st">"master"</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="pre-release-version">Pre-release version<a class="anchor" aria-label="anchor" href="#pre-release-version"></a>
</h3>
<p>To install the pre-release version that is available in Git branch <code>develop</code> on GitHub, use:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"HenrikBengtsson/marshal"</span>, ref<span class="op">=</span><span class="st">"develop"</span><span class="op">)</span></span></code></pre></div>
<p>This will install the package from source.</p>
</div>
</div>
</div>

  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/HenrikBengtsson/marshal/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/HenrikBengtsson/marshal/issues" class="external-link">Report a bug</a></li>
<li><a href="https://github.com/HenrikBengtsson/marshal/milestones" class="external-link">Roadmap/Milestones</a></li>
<li><a href="https://www.futureverse.org/" class="external-link">The Futureverse Project</a></li>
<li><a href="https://github.com/HenrikBengtsson/future/discussions" class="external-link">Futureverse User Forum</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>

<div class="community">
<h2 data-toc-skip>Community</h2>
<ul class="list-unstyled">
<li><a href="CONTRIBUTING.html">Contributing guide</a></li>
</ul>
</div>

<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing marshal</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Henrik Bengtsson <br><small class="roles"> Author, maintainer, copyright holder </small>  </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/HenrikBengtsson/marshal/actions?query=workflow%3AR-CMD-check" class="external-link"><img border="0" src="https://github.com/HenrikBengtsson/marshal/actions/workflows/R-CMD-check.yaml/badge.svg?branch=develop" alt="R CMD check status"></a></li>
</ul>
</div>

  </div>
</div>


      <footer><div class="copyright">
  <p></p>
<p>Developed by Henrik Bengtsson.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7</p> and <a href="https://github.com/HenrikBengtsson/pkgdown.extras/">pkgdown.extras</a> 0.0.0.9005.</p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: 'aa6e02fc501886fb0f7c91ac4e300456',
    indexName: 'futureverse',
    algoliaOptions: { 'facetFilters': ['project:marshal'] },
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
